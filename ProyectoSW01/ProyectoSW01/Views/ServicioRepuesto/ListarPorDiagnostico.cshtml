@model IEnumerable<ProyectoSW01.Models.ServicioRepuesto>

@{
    ViewData["Title"] = "Repuestos por Diagnóstico-Servicio";
    var diagServId = ViewBag.DiagServId as int? ?? 0;
}

<!-- TAILWIND -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- MATERIAL ICONS -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

<!-- jQuery + DataTables -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<link rel="stylesheet"
      href="https://cdn.datatables.net/2.1.3/css/dataTables.dataTables.min.css" />
<script src="https://cdn.datatables.net/2.1.3/js/dataTables.min.js"></script>


<div class="max-w-6xl mx-auto px-4 py-8">

    <!-- TÍTULO + BOTÓN SUPERIOR -->
    <div class="flex items-center justify-between mb-6">
        <div>
            <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-2">
                <span class="material-icons-round text-orange-500">construction</span>
                Repuestos usados en el servicio
            </h1>

            <p class="text-sm text-gray-500 mt-1">
                Diagnóstico-Servicio ID:
                <span class="font-semibold text-gray-800">@diagServId</span>
            </p>
        </div>

        <a asp-action="Create"
           asp-route-diagServId="@diagServId"
           class="inline-flex items-center gap-2 bg-orange-600 text-white px-5 py-2.5 rounded-xl
                  hover:bg-orange-700 shadow-md hover:shadow-lg transition text-sm">
            <span class="material-icons-round text-base">add</span>
            Agregar repuesto
        </a>
    </div>


    <!-- Buscador DataTables -->
    <div class="flex justify-center mb-6">
        <div class="w-full max-w-md relative">
            <input id="tablaBuscador"
                   type="text"
                   placeholder="Buscar repuestos por ID, cantidad o precio..."
                   class="w-full px-4 py-2 pl-10 border border-gray-300 rounded-xl shadow-sm
                          focus:ring-2 focus:ring-orange-400 focus:border-orange-400 outline-none" />
            <span class="material-icons-round absolute left-2 top-2.5 text-gray-400">
                search
            </span>
        </div>
    </div>


    <!-- TABLA -->
    <div class="bg-white shadow-xl rounded-2xl overflow-hidden p-3">
        <table id="repuestosTable" class="display w-full text-sm">
            <thead class="bg-orange-600 text-white">
                <tr>
                    <th class="px-4 py-3 text-left">ID</th>
                    <th class="px-4 py-3 text-left">DiagServ ID</th>
                    <th class="px-4 py-3 text-left">Repuesto ID</th>
                    <th class="px-4 py-3 text-left">Cantidad</th>
                    <th class="px-4 py-3 text-left">Precio unitario</th>
                    <th class="px-4 py-3 text-left">Subtotal</th>
                    <th class="px-4 py-3 text-center">Acciones</th>
                </tr>
            </thead>

            <tbody class="text-gray-700">
                @foreach (var item in Model)
                {
                    var subtotal = item.Cantidad * item.Precio;

                    <tr class="hover:bg-gray-50 transition">
                        <td class="px-4 py-3">@item.ServRepId</td>
                        <td class="px-4 py-3">@item.DiagServId</td>
                        <td class="px-4 py-3">@item.RepuestoId</td>
                        <td class="px-4 py-3">@item.Cantidad</td>
                        <td class="px-4 py-3">@item.Precio.ToString("C")</td>
                        <td class="px-4 py-3 font-semibold text-green-700">@subtotal.ToString("C")</td>

                        <td class="px-4 py-3 text-center">
                            <div class="flex items-center justify-center gap-2">

                                <!-- Ver -->
                                <a asp-action="Details" asp-route-id="@item.ServRepId"
                                   class="inline-flex items-center justify-center w-9 h-9 rounded-full
                                              bg-blue-50 text-blue-600 hover:bg-blue-100">
                                    <span class="material-icons-round text-base">visibility</span>
                                </a>

                                <!-- Editar -->
                                <a asp-action="Edit" asp-route-id="@item.ServRepId"
                                   class="inline-flex items-center justify-center w-9 h-9 rounded-full
                                              bg-amber-50 text-amber-600 hover:bg-amber-100">
                                    <span class="material-icons-round text-base">edit</span>
                                </a>

                                <!-- Eliminar -->
                                <a asp-action="Delete" asp-route-id="@item.ServRepId"
                                   class="inline-flex items-center justify-center w-9 h-9 rounded-full
                                              bg-red-50 text-red-600 hover:bg-red-100">
                                    <span class="material-icons-round text-base">delete</span>
                                </a>

                            </div>
                        </td>

                    </tr>
                }
            </tbody>
        </table>
    </div>


    <!-- BOTÓN VOLVER -->
    <div class="mt-6 flex justify-center">
        <a asp-controller="ServicioRepuesto" asp-action="Index" asp-route-diagServId="@diagServId"
           class="inline-flex items-center gap-2 bg-slate-800 text-white px-5 py-2 rounded-xl
                  hover:bg-slate-700 shadow-md text-sm">
            <span class="material-icons-round text-base">arrow_back</span>
            Volver
        </a>
    </div>

</div>


<script>
    let tabla;

    $(document).ready(function () {

        tabla = new DataTable('#repuestosTable', {
            language: {
                url: 'https://cdn.datatables.net/plug-ins/2.1.3/i18n/es-ES.json'
            },
            pageLength: 10,
            order: [[0, 'asc']]
        });

        // Buscador en tiempo real
        $('#tablaBuscador').on('input', function () {
            tabla.search(this.value).draw();
        });

    });
</script>
