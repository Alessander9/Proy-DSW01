@model IEnumerable<ProyectoSW01.Models.Mantenimiento>

@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>Mantenimientos programados</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

    <!-- jQuery (necesario para DataTables 2.x) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- DataTables 2.x -->
    <link rel="stylesheet"
          href="https://cdn.datatables.net/2.1.3/css/dataTables.dataTables.min.css" />
    <script src="https://cdn.datatables.net/2.1.3/js/dataTables.min.js"></script>
</head>
<body class="bg-gray-100">

    <div class="max-w-6xl mx-auto px-4 py-6">

        <!-- Título + botón NUEVO (derecha) -->
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-2xl font-bold text-blue-900 flex items-center gap-2">
                <span class="material-icons text-blue-900">build_circle</span>
                Mantenimientos programados
            </h1>

            <a asp-action="Create"
               class="inline-flex items-center px-4 py-2 rounded-lg bg-blue-900 text-white text-sm font-semibold hover:bg-blue-700 transition">
                <span class="material-icons text-sm mr-1">add_circle</span>
                Nuevo mantenimiento
            </a>
        </div>

        <!-- Buscador personalizado -->
        <div class="flex justify-center mb-6">
            <div class="w-full max-w-md relative">
                <input id="tablaBuscador"
                       type="text"
                       placeholder="Buscar mantenimiento por vehículo, servicio, estado, etc..."
                       class="w-full px-4 py-2 pl-10 border border-gray-300 rounded-xl shadow-sm
                              focus:ring-2 focus:ring-blue-400 focus:border-blue-400 outline-none" />
                <span class="material-icons absolute left-2 top-2.5 text-gray-400">
                    search
                </span>
            </div>
        </div>

        <!-- Si no hay registros -->
        @if (!Model.Any())
        {
            <div class="bg-blue-50 border border-blue-100 text-blue-900 px-4 py-3 rounded-lg flex items-center gap-2">
                <span class="material-icons">info</span>
                <span>No hay mantenimientos registrados.</span>
            </div>
        }
        else
        {
            <!-- Tabla -->
            <div class="overflow-x-auto rounded-xl shadow bg-white">
                <table id="mantenimientosTable" class="min-w-full text-sm display">
                    <thead class="bg-blue-50 border-b border-blue-100">
                        <tr>
                            <th class="px-4 py-3 text-left font-semibold text-blue-900">
                                <span class="material-icons align-middle text-sm mr-1">tag</span>ID
                            </th>

                            <th class="px-4 py-3 text-left font-semibold text-blue-900">
                                <span class="material-icons align-middle text-sm mr-1">directions_car</span>
                                Vehículo (Placa - Marca Modelo)
                            </th>

                            <th class="px-4 py-3 text-left font-semibold text-blue-900">
                                <span class="material-icons align-middle text-sm mr-1">home_repair_service</span>
                                Servicio
                            </th>

                            <th class="px-4 py-3 text-left font-semibold text-blue-900">
                                <span class="material-icons align-middle text-sm mr-1">event</span>
                                Fecha programada
                            </th>

                            <th class="px-4 py-3 text-left font-semibold text-blue-900">
                                <span class="material-icons align-middle text-sm mr-1">event_available</span>
                                Fecha entrega
                            </th>

                            <th class="px-4 py-3 text-left font-semibold text-blue-900">
                                <span class="material-icons align-middle text-sm mr-1">flag</span>
                                Estado
                            </th>

                            <th class="px-4 py-3 text-right font-semibold text-blue-900">
                                <span class="material-icons align-middle text-sm mr-1">more_horiz</span>
                                Acciones
                            </th>
                        </tr>
                    </thead>

                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr class="border-b last:border-0 hover:bg-gray-50">

                                <!-- ID -->
                                <td class="px-4 py-3">
                                    @item.MantenimientoId
                                </td>

                                <!-- Vehículo: PLACA - Marca Modelo -->
                                <td class="px-4 py-3">
                                    <span class="inline-flex items-center gap-1 font-semibold text-gray-800">
                                        <span class="material-icons text-xs text-blue-900">directions_car</span>
                                        @($"{item.Placa} - {item.Marca} {item.Modelo}")
                                    </span>
                                </td>

                                <!-- Servicio: Nombre -->
                                <td class="px-4 py-3">
                                    <span class="inline-flex items-center gap-1 font-semibold text-gray-800">
                                        <span class="material-icons text-xs text-blue-900">build</span>
                                        @item.ServicioNombre
                                    </span>
                                </td>

                                <!-- Fecha programada -->
                                <td class="px-4 py-3">
                                    @(item.FechaProgramada?.ToString("dd/MM/yyyy HH:mm") ?? "-")
                                </td>

                                <!-- Fecha entrega -->
                                <td class="px-4 py-3">
                                    @(item.FechaEntrega?.ToString("dd/MM/yyyy HH:mm") ?? "-")
                                </td>

                                <!-- Estado con colores -->
                                <td class="px-4 py-3">
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold
                                                  @(item.Estado == "programado" ? "bg-blue-50 text-blue-900" :
                                                                                      item.Estado == "en_proceso" ? "bg-yellow-50 text-yellow-700" :
                                                                                      item.Estado == "entregado" ? "bg-green-50 text-green-700" :
                                                                                      item.Estado == "cancelado" ? "bg-red-50 text-red-700" :
                                                                                      "bg-gray-50 text-gray-700")">
                                @item.Estado
                            </span>
                        </td>

                                <!-- Acciones -->
                                <td class="px-4 py-3 text-right">
                                    <div class="inline-flex items-center gap-1">

                                        <!-- Ver -->
                                        <a asp-action="Details" asp-route-id="@item.MantenimientoId"
                                           class="inline-flex items-center px-2 py-1 rounded-md text-blue-900 border border-blue-100 hover:bg-blue-50 text-xs font-medium transition">
                                            <span class="material-icons text-sm mr-0.5">visibility</span>
                                            Ver
                                        </a>

                                        <!-- Editar -->
                                        <a asp-action="Edit" asp-route-id="@item.MantenimientoId"
                                           class="inline-flex items-center px-2 py-1 rounded-md text-amber-700 border border-amber-100 hover:bg-amber-50 text-xs font-medium transition">
                                            <span class="material-icons text-sm mr-0.5">edit</span>
                                            Editar
                                        </a>

                                        <!-- Eliminar -->
                                        <a asp-action="Delete" asp-route-id="@item.MantenimientoId"
                                           class="inline-flex items-center px-2 py-1 rounded-md text-red-700 border border-red-100 hover:bg-red-50 text-xs font-medium transition">
                                            <span class="material-icons text-sm mr-0.5">delete</span>
                                            Eliminar
                                        </a>

                                    </div>
                                </td>

                            </tr>
                                        }
                    </tbody>

                </table>
            </div>
        }

        <!-- Botón Menú de Mantenimientos -->
        <div class="mt-6 flex justify-center">
            <a asp-action="MenuMantenimiento"
               class="inline-flex items-center gap-2 bg-slate-800 text-white px-5 py-2 rounded-xl hover:bg-slate-700 shadow-md text-sm">
                <span class="material-icons text-base">arrow_back</span>
                Menú de Mantenimientos
            </a>
        </div>

    </div>

    <script>
        let table;

        $(document).ready(function () {

            // Inicializar DataTables 2.x
            table = new DataTable('#mantenimientosTable', {
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/2.1.3/i18n/es-ES.json'
                },
                pageLength: 10,
                lengthMenu: [5, 10, 25, 50, 100],
                order: [[0, 'desc']]
            });

            // Buscador personalizado en tiempo real
            $('#tablaBuscador').on('input', function () {
                table.search(this.value).draw();
            });
        });
    </script>

</body>
</html>
